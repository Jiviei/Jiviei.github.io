---
order: 3
title: "@DK @AL [done]\_!!!  Решение конфликта после перезагрузки страницы"
---

Сейчас если перезагрузить страницу или закрыть её во время решения конфилкта, то каталог сломается и пользователю будет непонятно как его починить.

#### Критерии приемки

1. Если пользователь закрыл/перезагрузил вкладку во время решения конфилкта, а потом снова открыл каталог с конфликтом, то показывается модальное окно с предупреждением:

   1. Тип: warning

   2. Заголовок: [icon:circle-alert] Решите конфликт

   3. Текст: Ваш каталог находится в состоянии конфликта. Решите его прежде чем продолжить редактирование.

   4. Кнопки:

      1. Отмена - при нажатии откатывает каталог в состояние до конфликта

      2. Решить конфликт - открывается окно решения конфликта

2. Если пользователь открыл по ссылке каталог, которых находится в состоянии конфликта, но в ссылке отличается название ветки, то показывать предупреждение:

   1. Тип: warning

   2. Заголовок: [icon:circle-alert] Решите конфликт

   3. Текст: Ссылка ведет на ветку `{название ветки}`, но ваш каталог находится в состоянии конфликта. Решите его прежде чем продолжить редактирование.

   4. Кнопки:

      1. Отмена - при нажатии откатывает каталог в состояние до конфликта

      2. Решить конфликт - открывается окно решения конфликта

   Пользователю придется самому переключать ветку после решения конфликта.

3. Если пользователь открыл по ссылке каталог, который находится в состоянии конфликта, но доступна более новая версия каталога, то игнорировать это и показывать предупреждение из пункта 1.

#### Design details

1. В каждом каталоге будет файл `gramax-settings` в папке `.git`. В нем будет хранится состояние в виде JSON. Например:

   ```json
   {
   	"state": {
   		"value": "mergeConflict",
   		"data": {
   			"deleteAfterMerge": true,
   			"theirs": "master",
   			"conflictFiles": [
   				{
   					"status": "bothModified",
   					"path": "docs/article1.md"
   				},
   				{
   					"status": "addedByUs",
   					"path": "docs/article2.md"
   				}
   			],
   			"reverseMerge": true,
   			"branchNameBefore": "master"
   		}
   	}
   }
   ```

2. Перед решением конфликта, в файл `gramax-settings` будет записываться вся информация о состоянии конфилкта.

3. Если пользователь открыл каталог в состоянии конфликта, gramax восстановит состояние из файла `gramax-settings`



#### Дальнейшие шаги

Паша хочет в рамках ускорения fs сделать транзакции на уровне команды..