---
order: 9
title: "@PS @AL [done] Открытие ссылок в приложении"
---

Сейчас есть веб- и десктоп- приложения. В этих приложениях свои каталоги со своим состоянием. При открытии ссылки на статью, у пользователя нет возможности легко открыть статью в десктопном приложении.

Нужно, чтобы пользователь имел возможность открыть текущую статью в десктоп-приложении из веб-версии и наоборот по одному клику.

## Критерии

1. Поддерживается протокол `gramax://` в десктоп-приложении.

   1. При использовании этого протокола, десктоп-приложение открывается, если было закрыто, и открывает `<path>` из `gramax://<path>`.

   2. Пример: `gramax://gitlab.ics-it.ru/dr/gramax-board/master/-/may-2024/app-protocol` откроет эту US в десктоп-приложении.

2. В веб-приложении в правой панели над “Сообщить об ошибке“ есть кнопка “Открыть в приложении“.

   1. При нажатии на кнопку, открывается приложение с текущей статьёй.

   2. Если открыть приложение не удалось (например, если оно не установлено. Как происходит проверка -- описано в технических деталях), показывается предупреждение:

      *Заголовок*: Приложение не установлено

      *Тело*: [Скачайте приложение](https://gram.ax/) и попробуйте еще раз.

      *Кнопка*: Понятно

   3. При успешном открытии статьи, текущая вкладка в браузере не закрывается

3. В дев версии десктоп-приложения в правой панели над “Сообщить об ошибке“ есть кнопка “Открыть в браузере“.

4. В кнопках “Открыть в …“ используется логотип Gramax в качестве иконки. Как на док-портале.

## Оценка

Реализация: 8-12ч

## Референсы

1. **Фигма.** При открытии ссылки, по умолчанию фигма не предлагает открыть приложение. Но есть кнопка “Open in desktop app“. При нажатии этой кнопки, открывет приложение и фигма предлагает сделать это поведение дефолтным (всегда открывать в приложении)

2. **Discord.** Сразу пытается открыть приложение, если оно установленно. Нужно постараться, чтобы открыть в браузере. Не обращает внимания на используемую версию - stable или canary.

## Технические ограничения

1. Не поддерживается работа протокола на Linux. Будет реализовано после [обновления Tauri](./../../jun-2024/prilozhenie-2/ps-open-tech-obnovlenie-tauri-do-2-0-0-rc.md).

## Технические детали

### Как проверять, открылась ли статья

Десктопное приложение слушает зарезервированный порт `52055` и при обращении на этот порт, приложение отвечает пустым HTTP Response.

После перенаправления пользователя на `gramax://<path>` через `500ms` проверяется, отвечает ли приложение. Если приложение не отвечает - попытка повторяется ещё три раза с интервалом `1000ms`.  При неудаче считается, что открыть статью не удалось и пользователь видет предупреждение.

## Замечания

-  Если приложение закрыто, то в вебе при нажатии на кнопку “Открыть в приложении“ открывается главная страница, а не соответствующая.

-  С веба при открытии каталога в приложении, которого ещё нет в десктопе, не появляется никакое сообщение, что каталог не загружен. Открывается главная страница.